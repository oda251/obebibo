# テストガイドライン

## 基本方針

- すべての主要機能・ロジックに対して自動テスト（RSpec）を記述する。
- バグ防止・リファクタリング・仕様変更時の安全性担保を目的とする。
- テストコードも本番コード同様に保守・品質管理の対象とする。

---

## テスト種別

- **モデルテスト**: バリデーション・関連・メソッドの挙動を検証。
- **リクエスト/コントローラテスト**: API/画面遷移・認可・レスポンス内容を検証。
- **システムテスト**: 画面操作・ユーザー操作の一連の流れを検証（Capybara 等）。
- **ヘルパー/サービステスト**: 補助関数・業務ロジックの単体検証。
- **ジョブ/メールテスト**: 非同期処理・メール送信の挙動検証。

---

## 記述ルール

- FactoryBot でテストデータを管理し、テストの独立性・再現性を担保。
- 1 テスト 1 責務（単一機能・単一条件）を意識。
- テスト名・describe/context/it は「何を・どう検証するか」が明確に伝わるよう記述。
- before/after で副作用を制御し、テスト間の依存を排除。
- 期待値（assertion）は具体的・明確に。
- 外部 API や非同期処理は stub/mock で制御。

---

## カバレッジ・運用

- 主要モデル・コントローラ・サービスは カバレッジ95%以上を徹底。
- バグ・障害報告時は必ず再現テストを追加。
- CI/CD で自動テストを必須化。
- テスト失敗時は原因究明・修正・再テストを徹底。

---

## 備考

- テストコードもリファクタリング・レビュー対象。
- テストデータに個人情報・機密情報は含めない。
- テストの粒度・範囲はプロジェクト状況に応じて柔軟に調整。
